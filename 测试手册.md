# 测试手册

在本手册中，我们将不对 Scale UI 本身提供的能力进行测试。

## / Home

### 页面基础功能

1. 页面应该能每隔一分钟自动更新一次数据，并显示最后一次刷新的时间，但不是重新加载页面

   - 显示格式：`Last Auto Update at HH:mm:ss` 或 `Auto Refresh Enabled`
   - 应有闪烁动画指示器（Blink class）

2. TopNavBar 应该能够正确跳转到对应的页面

3. 登录后应该能正常显示用户名

### 通知栏（Notification Bar）

1. **异常状态通知**：

   - 当有服务异常时，应显示警告通知（variant="warning"）
   - 单个服务异常：`1 component has an issue, but don't worry, we are working on it.`
   - 多个服务异常：`X components have issues, but don't worry, we are working on it.`

2. **正常状态通知**：

   - 当所有服务正常时，应显示成功通知（variant="success"）
   - 文本内容：`All Systems Operational`

3. **计数逻辑**：
   - 只统计开放状态（IsOpenStatus）的 Incident 类型事件
   - 按服务去重，同一服务有多个事件只计算一次
   - 不包含已结束的 Incident

### Current Events 数据表格

1. **显示条件**：

   - 只显示当前活动的事件（开放状态）
   - 对于 Incident 类型，不显示已结束的事件
   - 不包含 Information 类型事件（会被过滤掉）
   - 当没有活动事件时，整个表格应隐藏

2. **表格结构**：

   - 分页大小：4 行

3. **列定义**：

   - **ID**：数字类型，显示事件 ID
   - **Type**：标签类型，显示事件类型标签
   - **Start CET**：日期类型，可排序，显示开始时间
   - **Status / Plan CET**：文本类型，显示状态或结束时间
   - **Region**：文本类型，可排序，显示区域
   - **Service**：文本类型，可排序，显示服务
   - **Detail**：操作类型，显示详情按钮

4. **事件类型标签颜色**：

   - **Minor Incident**：黄色（yellow）
   - **Major Incident**：橙色（orange）
   - **Service Outage**：红色（red）
   - **Maintenance**：青色（cyan）
   - **Information**：标准色（standard）

5. **数据处理逻辑**：

   - 按开始时间倒序排列（最新在前）
   - 区域显示：多个区域用逗号分隔
   - 服务显示：超过 3 个服务时显示前 3 个 + 剩余数量（如 `Service1, Service2, Service3 +2`）
   - 时间格式：按时区显示（CET）

6. **详情按钮**：

   - 显示 "↗" 符号
   - 样式：secondary variant
   - 点击跳转到 `/Event/{EventId}` 页面

### Current Status 区域

1. **区域选择器（RegionSelector）**：

   - 右侧 TabNav 应该能够正确列出全部 Region
   - 默认选择第一个 Region
   - 点击可切换到对应的 Region

2. **状态卡片**：

   - 按 Category 名称字母顺序排列

3. **服务列表**：
   - 按服务名称字母顺序排列
   - 每个服务包含状态指示器和名称

### 服务状态指示器

1. **状态图标映射**：

   - **Operational**：action-success（绿色）
   - **Maintenance**：service-maintanance（蓝色）
   - **Minor Incident**：action-minus-circle（黄色）
   - **Major Incident**：alert-warning（橙色）
   - **Service Outage**：action-circle-close（红色）
   - **Information**：alert-information（灰色）

2. **状态计算逻辑**：

   - 优先显示最高严重级别的事件状态
   - 过滤掉已结束的 Incident 和 Information 类型
   - 只显示开放状态的事件

3. **计划维护指示**：

   - 未来时间的事件显示为 Operational 图标 + 蓝色圆点
   - 使用 FluentProvider 和 CounterBadge

4. **链接行为**：

   - 有活动事件的服务：点击跳转到事件详情页
   - 计划维护：点击跳转到对应事件页面
   - 正常服务：不可点击

### 页面底部图例

1. **自动更新状态**：

   - 左侧显示闪烁指示器和更新时间
   - 格式：`Last Auto Update at HH:mm:ss` 或 `Auto Refresh Enabled`

2. **事件类型图例**：

   - 显示所有 EventType 的图标和名称
   - 特殊显示：Operational + 蓝色圆点 = "Planned Maintenance"

## History

1. 按不同的年月进行分组，按时间顺序列出事件。

2. 显示事件的基本信息，包括受影响的服务，区域，时间，当前状态。

3. 点击事件标题可以跳转到事件的详细信息。

## Event

### 事件详情显示

1. 正确显示当前事件的详细信息，包括 Type, Status, Start End Time, Description 并列出所有受影响的服务和区域。

2. 正确按时间从新到旧列出 Update 时间线。

3. 在登录状态下可编辑。

### 事件编辑表单验证规则

#### Title 验证

1. 标题长度必须在 8-100 个字符之间

   - 少于 8 个字符时显示："Title must be between 8 and 100 characters."
   - 超过 100 个字符时显示："Title must be between 8 and 100 characters."

2. 标题不能为空
   - 为空时显示："Title is required."

#### Type 验证

1. 事件类型不能为空

   - 为空时显示："Type is required."

2. 事件类型必须是有效值之一：

   - Operational
   - Maintenance
   - Minor Incident
   - Major Incident
   - Service Outage
   - Information
   - 无效类型时显示："Invalid event type."

3. 当事件类型改变时，状态选项会自动重置

#### Update Message 验证

1. 更新消息长度必须在 10-200 个字符之间

   - 少于 10 个字符时显示："Update Message must be between 10 and 200 characters."
   - 超过 200 个字符时显示："Update Message must be between 10 and 200 characters."

2. 更新消息不能为空
   - 为空时显示："Update Message is required."

#### Status 验证

1. 状态不能为空

   - 为空时显示："Status is required."

2. 状态必须是有效值之一，根据事件类型不同：

   - **Incident 类型**（Minor/Major/Outage）：Detected, Analysing, Fixing, Observing, Resolved
   - **Maintenance 类型**：Planned, Modified, In Progress, Completed, Cancelled
   - **Information 类型**：Planned, Active, Completed, Cancelled
   - 无效状态时显示："Invalid event status."

#### Start Date 验证

1. 开始时间不能晚于结束时间

   - 违反时显示："Start Date cannot be later than End Date."

2. 对于 Incident 类型事件，开始时间不能是未来时间
   - 违反时显示："Start Date cannot be in the future."

#### End Date 验证

1. 结束时间不能早于开始时间
   - 违反时显示："End Date cannot be before Start Date."

#### Update Date 验证

1. 对于 Incident 类型事件，更新时间不能早于开始时间
   - 违反时显示："Update Date cannot be earlier than Start Date."

### 特殊业务逻辑

1. **事件类型变更**：当事件类型从当前类型变更时，后端状态会设置为 "ImpactChanged"

2. **非 Incident 类型事件**：更新时会发送开始时间

3. **已关闭事件重新开启**：

   - 如果事件状态从关闭状态变更，后端状态会设置为 "Reopened"，结束时间会被清除
   - 如果状态未变更但是 Incident 类型，后端状态会设置为 "Changed"，会发送开始时间

4. **状态分类**：

   - **开放状态**：除了 Completed, Resolved, Cancelled 之外的所有状态
   - **关闭状态**：Completed, Resolved, Cancelled

5. **事件更新成功后**：
   - 更新消息字段会被清空
   - 状态字段会被重置
   - 更新时间会重置为当前时间
   - 本地数据会同步更新，包括历史记录的添加

## Availability

1. 应正确显示 RegionSelector 组件，允许用户选择不同的区域

### 可用性矩阵表格

1. **表头结构**：

   - 第一行应包含 "Category"、"Service" 列标题，以及 "Availability, %" 合并列标题
   - 第二行应显示最近 6 个月的年月信息，格式为 "YYYY 月份名称"（如 "2025 August"）
   - 表头应该是粘性的（sticky），在滚动时保持在顶部

2. **时间范围**：

   - 应显示当前月份往前推 5 个月，总共 6 个月的数据
   - 月份应按时间顺序从左到右排列（最早到最新）

3. **数据分组和排序**：
   - 服务应按 Category 进行分组
   - Category 应按名称字母顺序排序
   - 同一 Category 下的服务应正确分组显示

### 可用性数据显示

1. **Category 列**：

   - 每个服务分类应使用 rowSpan 合并显示，只在第一行显示分类名称
   - 分类名称应正确显示且字体大小为 text-lg

2. **Service 列**：

   - 每个服务应显示其完整名称
   - 服务名称字体大小应为 text-lg

3. **可用性百分比**：
   - 每个月的可用性应显示为百分比，保留两位小数（如 "99.95"）
   - 数据应居中对齐
   - 如果服务数据不足 6 个月或无数据，应默认显示 100.00%

### 可用性颜色编码

1. **颜色规则**：

   - **绿色**（emerald）：可用性 >= 99.95%
     - 背景色：bg-emerald-100
     - 悬停色：hover:bg-emerald-200
   - **黄色**（amber）：可用性 >= 99% 且 < 99.95%
     - 背景色：bg-amber-100
     - 悬停色：hover:bg-amber-200
   - **红色**（rose）：可用性 < 99%
     - 背景色：bg-rose-100
     - 悬停色：hover:bg-rose-200

2. **颜色应用**：
   - 每个可用性百分比单元格应根据其数值自动应用对应的背景色
   - 鼠标悬停时应显示对应的悬停颜色

### 区域切换功能

1. 用户应能通过 RegionSelector 切换不同区域

2. 切换区域后，矩阵应只显示该区域下的服务可用性数据

3. 区域切换应是响应式的，无需页面刷新

### 数据加载

1. 页面加载时应显示加载指示器，文本为 "Loading Availability..."

2. 数据应从后端 `/v2/availability` 接口获取

3. 如果服务在数据库中不存在，应在控制台记录警告信息

4. 数据应支持缓存机制

### 响应式设计

1. 表格应具有相对定位（relative）

2. 每个月份列应占据相等的宽度（w-1/12）

3. 表格应支持水平滚动以适应较小屏幕

### 错误处理

1. 如果无法获取可用性数据，应有适当的错误处理

2. 对于缺失的服务数据，应 gracefully 降级处理（显示 100%）

## NewEvent

1. TODO
